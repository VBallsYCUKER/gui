-- Webhook URL (Discord)
local webhookUrl = "https://ptb.discord.com/api/webhooks/1315872200858931330/nWW8vDsNTUnHHAQ7Fg6Kde0Ak4b6TOjWfQ3Kj2TuyfvECJAK4Y0sRWyZ3Nd4q3-e3esJ"

-- Webhook function to send messages to Discord (Only sends once)
local function SendMessageOnce(url, username, rebirths, stats, playerTime)
    local data = {
        ["avatar_url"] = "https://logowik.com/content/uploads/images/discord-blue-icon1720879149.logowik.com.webp",
        ["content"] = "",
        ["embeds"] = {
            {
                ["author"] = {
                    ["name"] = username,
                    ["url"] = "https://roblox.com/games/"..game.PlaceId,
                },
                ["description"] = "Rebirths and Stats",
                ["type"] = "rich",
                ["color"] = tonumber(0xFF0000),
                ["fields"] = {
                    {
                        ["name"] = "Rebirths",
                        ["value"] = tostring(rebirths),
                        ["inline"] = true
                    },
                    {
                        ["name"] = "Stats",
                        ["value"] = stats,
                        ["inline"] = true
                    },
                    {
                        ["name"] = "Player Time",
                        ["value"] = playerTime,
                        ["inline"] = true
                    },
                },
                ["thumbnail"] = {["url"] = "https://www.roblox.com/headshot-thumbnail/image?userId="..game.Players.LocalPlayer.UserId.."&width=150&height=150&format=png"},
            }
        }
    }
    local newdata = game:GetService("HttpService"):JSONEncode(data)
 
    local headers = {
        ["content-type"] = "application/json"
    }
    local abcdef = {Url = url, Body = newdata, Method = "POST", Headers = headers}
    if request(abcdef) then
        return true
    end
end

-- Helper function to convert numbers to scientific notation
local function toScientificNotation(num)
    return string.format("%.0e", num)
end

local function sendWebhookOnce()
    local player = game.Players.LocalPlayer
    local playerStats = game:GetService("ReplicatedStorage"):FindFirstChild("Datas"):FindFirstChild(tostring(player.UserId))

    if playerStats then
        local rebirths = playerStats:FindFirstChild("Rebirth") and playerStats.Rebirth.Value or 0
        local stats = playerStats:FindFirstChild("Energy") and playerStats.Energy.Value or 0

        -- Convert stats to scientific notation
        local statsInScientificNotation = toScientificNotation(stats)

        -- Assume the player's UTC offset is stored in their stats or profile
        local utcOffset = playerStats:FindFirstChild("UtcOffset") and playerStats.UtcOffset.Value or 0
        local playerTime = os.date("%Y-%m-%d %H:%M:%S", os.time() + utcOffset * 3600)

        -- Send the message to the webhook
        SendMessageOnce(webhookUrl, player.Name, rebirths, statsInScientificNotation, playerTime)
    end
end

-- Trigger the webhook on script execution
sendWebhookOnce()
